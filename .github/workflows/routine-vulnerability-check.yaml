name: Routine Vulnerability Check

on:
    schedule:
        -   cron: '0 0 * * 0'  # Every Sunday at midnight
    workflow_dispatch:
    pull_request:
        branches:
            - master
    push:
        branches:
            - master

jobs:
    vulnerability-check:
        runs-on: ubuntu-latest

        strategy:
            matrix:
                java-version: [ 8 ]

        steps:
            -   name: Checkout code
                uses: actions/checkout@v4.2.2
                with:
                  fetch-depth: 0

            -   name: SÃ¤tt upp JDK ${{ matrix.java-version }}
                uses: actions/setup-java@v4.7.1
                with:
                    java-version: ${{ matrix.java-version }}
                    distribution: 'temurin'

            -   name: Cache Maven dependencies
                uses: actions/cache@v4.2.3
                with:
                    path: ~/.m2
                    key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
                    restore-keys: ${{ runner.os }}-m2

            -   name: Run vulnerability scan
                run: mvn verify -DskipTests -Pdependency-check

            -   name: Upload vulnerability report
                uses: actions/upload-artifact@v4.6.2
                with:
                    path: target/dependency-check-report.html
                    name: dependency-check-report
